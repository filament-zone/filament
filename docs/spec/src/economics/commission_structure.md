# Commission Structure

The Filament protocol uses a sophisticated commission structure to reward Delegates for their participation in campaigns and, crucially, to incentivize them to make decisions that lead to *positive economic outcomes*. This structure combines a base commission with a mechanism based on the Vickrey-Clarke-Groves (VCG) auction, ensuring that Delegates are rewarded proportionally to their contribution to the campaign's success.

## I. Base Commission

The base commission provides a fundamental reward for Delegate participation, regardless of the specific economic outcome of the campaign. This ensures that Delegates are compensated for their time and effort in reviewing proposals and casting votes.

*   **Eligibility:** To be eligible for the base commission, Delegates *must* participate in the relevant voting phases of the campaign (Criteria and, in the full protocol, Distribution).  Delegates who fail to vote may be slashed (although slashing is not implemented in the simplified testnet version).
*   **Calculation:**
    *   The total commission for a campaign is calculated as: `median_campaign_reward * COMMISSION_MULTIPLE`.
        *   `median_campaign_reward`:  The median reward received by *Participants* in the campaign. This ties the Delegate commission to the overall scale of the distribution. This is calculated after the Distribution phase.
        *   `COMMISSION_MULTIPLE`: A protocol-wide parameter (set by governance) that determines the overall size of the commission pool.
    *   This total commission pool is then divided among the eligible Delegates *proportional to their voting power*.  A Delegate's voting power is determined by the amount of FILA they have staked (and any FILA delegated to them).
* **Delegator Share**: Delegates keep a portion of the commission (`DELEGATE_COMMISSION_CARVEOUT`) and distribute the rest to users that delegated their FILA to them.

**Example:**

*   `median_campaign_reward` = 1000 tokens
*   `COMMISSION_MULTIPLE` = 0.1 (10%)
*   Total Commission Pool = 1000 * 0.1 = 100 tokens
*   Delegate A has 20% of the total voting power.
*   Delegate A's base commission = 100 tokens * 0.2 = 20 tokens.
*   `DELEGATE_COMMISSION_CARVEOUT` = 0.2 (20%)
* Delegate A keeps = 20 tokens * 0.2 = 4 tokens
* Delegate A distributes = 20 - 4 = 16 tokens, to delegators

## II. VCG Mechanism (Incentivizing Economic Outcomes)

The core innovation of Filament's commission structure is the integration of a VCG (Vickrey-Clarke-Groves) mechanism. The VCG mechanism is a type of auction designed to incentivize *truthful revelation of preferences*. In Filament's context, this means incentivizing Delegates to vote for criteria and distributions that maximize the *economic value* generated by the campaign.

**A. Defining the Economic Metric (VG)**

Each campaign defines an *economic metric* (`V_G`) that the Campaigner wants to maximize. This metric represents the desired outcome of the campaign.  Examples include:

*   **Total Fees Generated:** For a campaign distributing tokens to liquidity providers on a DEX, the metric could be the total trading fees generated by those LPs over a specific period.
*   **Active Users:** For a campaign aimed at increasing user engagement, the metric could be the number of active users (defined by some specific actions) after the distribution.
*   **Governance Participation:**  For a campaign focused on governance, the metric could be the participation rate in governance proposals.
* **Value Locked:** For a campaign related to lending, the metric could be the total value locked by users who received tokens.

The *Campaigner* defines this metric when creating the campaign. The *Delegates* are then incentivized to choose criteria and distributions that maximize this metric.

**B. Marginal Contribution**

The VCG mechanism rewards Delegates based on their *marginal contribution* to the economic metric.  This is calculated as follows:

1.  **`V_G` (with all Delegates):** Calculate the economic metric achieved with *all* Delegates' votes included.
2.  **`V_G(-d)` (without Delegate `d`):**  For each Delegate `d`, recalculate the economic metric *as if that Delegate had not participated*.  This means removing their votes and re-running the criteria selection and distribution calculation.
3.  **Marginal Contribution (`ΔV_G(d)`)**: The difference between the two:
    `ΔV_G(d) = V_G - V_G(-d)`

This `ΔV_G(d)` value represents the *impact* of Delegate `d`'s votes on the overall economic outcome. If their votes led to a *better* outcome (higher `V_G`), their marginal contribution is positive. If their votes led to a *worse* outcome, their marginal contribution is negative.

**C. VCG Payment**

The VCG payment to a Delegate is based on their marginal contribution.  The formula is conceptually:

```
Payment(d) = ΔV_G(d) + h(other_delegates)
```

*   **`ΔV_G(d)`:**  The Delegate's marginal contribution.
*   **`h(other_delegates)`:**  A function that depends *only* on the other Delegates' votes (not Delegate `d`'s votes). This term ensures incentive compatibility.

In practice, in Filament, the `h(other_delegates)` is set to zero. So, the core of the VCG payment is simply the Delegate's marginal contribution. The total reward is then some constant multiplied by the marginal contribution, or zero if negative.

**D. Incentive Compatibility**

The VCG mechanism is *incentive-compatible*, meaning that the *dominant strategy* for each Delegate is to vote *truthfully* according to their beliefs about which criteria and distributions will maximize the economic metric.

*   **Why?**  If a Delegate tries to manipulate the outcome by voting strategically (not according to their true beliefs), they risk *decreasing* their own marginal contribution and, therefore, their payment.  The only way to reliably maximize their payment is to vote in a way that they believe will maximize the overall `V_G`.

**E. Practical Implementation in Filament**

1.  **Criteria Phase:** Delegates vote on criteria. The VCG mechanism is applied *after* the criteria are confirmed and the economic metric (`V_G`) is measured. The system calculates each Delegate's marginal contribution by hypothetically removing their votes and recalculating the outcome.
2.  **Distribution Phase (Full Protocol):** In the full protocol (not the simplified testnet version), Delegates will also vote on the final distribution. The VCG mechanism will be applied similarly, calculating the marginal contribution of each Delegate's votes on the distribution.
3.  **Reward Calculation:** The Delegate's final reward is a combination of the base commission and their VCG-based payment (proportional to their marginal contribution). This reward is then distributed in FILA.

## III. Example

Let's say a campaign aims to increase trading fees generated on a DEX.

1.  **Campaign Setup:**  The Campaigner defines the economic metric as "total trading fees generated by recipients of the token distribution over the next month."
2.  **Criteria Selection:** Delegates propose and vote on criteria (e.g., "users who have provided liquidity to pool X," "users who have traded at least $Y in the past").
3.  **Distribution (Simplified):** In the simplified version, there is no distribution vote.
4.  **Measurement:** After one month, the total trading fees generated by the token recipients are measured (this is `V_G`).
5.  **VCG Calculation:**
    *   The system recalculates the expected `V_G` *without* Delegate A's votes. Let's say this is `V_G(-A)`.
    *   Delegate A's marginal contribution is `ΔV_G(A) = V_G - V_G(-A)`.
    *   If `ΔV_G(A)` is positive, Delegate A receives a payment proportional to this contribution. If it's negative, they receive no VCG-based payment (but they still get the base commission if they participated).
    *   This process is repeated for all Delegates.

## IV. Benefits of the VCG Mechanism

*   **Incentive Alignment:** Aligns Delegates' incentives with the Campaigner's goals. Delegates are directly rewarded for contributing to the campaign's success.
*   **Truthful Revelation:** Encourages Delegates to vote honestly and share their expertise.
*   **Efficiency:**  Leads to more efficient token distributions, as the criteria and distribution are optimized to maximize the desired economic outcome.
*   **Resistance to Manipulation:**  Makes it difficult for Delegates to manipulate the outcome for their own benefit.
* **Sybil Resistance:** By tying rewards to economic outcomes, sybil attacks become less profitable.

## V. Conclusion

The Filament commission structure, with its combination of a base commission and the VCG mechanism, provides a powerful and sophisticated way to incentivize Delegates and ensure that token distribution campaigns achieve their intended economic goals.  This approach promotes fairness, efficiency, and alignment of interests among all participants in the Filament ecosystem. The VCG mechanism, in particular, is a key innovation that differentiates Filament from simpler airdrop mechanisms.
